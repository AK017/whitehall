<%
  policies ||= []
  topics ||= []
  history = document.change_history
%>
<div class="document-footer-meta js-footer">
  <div class="history">
    <dl class="primary-metadata">
      <dt><%= t('document.footer_meta.published') %>:</dt>
      <% if document.state != 'published' %>
        <dd>Preview</dd>
      <% else %>
        <dd><%= absolute_date(history.last.public_timestamp) %></dd>

        <% unless history.newly_published? %>
          <dt><%= t('document.footer_meta.updated') %>:</dt>
          <dd><%= absolute_date(history.first.public_timestamp) %></dd>
        <% end %>
      <% end %>
    </dl>
    <% unless history.newly_published? %>
      <div class="footer-change-notes js-toggle-footer-change-notes">
        <p class="toggle">+ <%= t('document.footer_meta.full_page_history') %></p>
        <div class="overlay js-hidden">
          <dl>
            <% history.each do |change| %>
              <dt><%= absolute_time(change.public_timestamp, class: 'published-at') %></dt>
              <dd><%= change.note %></dd>
            <% end %>
          </dl>
        </div>
      </div>
    <% end %>
  </div>
  <div class="links">
    <dl class="primary-metadata js-track-metadata-links" data-trackposition="bottom">
      <% from = from_metadata(document, true) %>
      <% if from %>
        <dt>From</dt>
        <% from.each do |link| %>
          <dd><%= link %></dd>
        <% end %>
      <% end %>

      <% part_of = part_of_metadata(document, policies, topics) %>
      <% if part_of.any? %>
        <dt>Part of</dt>
        <% part_of.each do |link| %>
          <dd><%= link %></dd>
        <% end %>
      <% end %>
    </dl>
  </div>
</div>
