<% page_title "Statistics", "Upcoming calendar" %>
<% page_class "release-announcements-index" %>

<header class="block headings-block">
  <div class="inner-block floated-children">
    <%= render partial: 'shared/heading',
              locals: { big: true,
                        heading: "Statistics: Upcoming calendar" } %>
  </div>
</header>

<%= render 'upcoming_calendar_tabs' %>

<div class="filter-form-block">
  <div class="inner-block">
    <h2>You can use the filters to show only results that match your interests</h2>
    <%= form_for @filter, url: statistics_announcements_path, method: :get, html: { class: "filter-form" } do |f| %>
      <fieldset>
        <div class="filter">
          <div class="filter-inner">
            <%= label_tag :keywords, "Contains" %>
            <%= text_field_tag :keywords, @filter.keywords, placeholder: "keywords" %>
          </div>
        </div>
        <div class="filter">
          <div class="filter-inner">
            <%= label_tag "organisations", "Department" %>
            <%= select_tag "organisations[]", organisation_options_for_statistics_announcement_filter(@filter.organisation_slugs), id: "organisations", class: "single-row-select" %>
          </div>
        </div>
        <div class="filter">
          <div class="filter-inner">
            <%= label_tag "topics", "Topic" %>
            <%= select_tag "topics[]", topic_options_for_statistics_announcement_filter(@filter.topic_slugs), id: "topics", class: "single-row-select" %>
          </div>
        </div>
        <div class="filter date-range-filter">
          <div class="filter-inner">
            <%= label_tag :from_date, "Published after" %>
            <%= text_field_tag :from_date, params[:from_date], placeholder: "e.g. 01/01/2013" %>

            <%= label_tag :to_date, "Published before" %>
            <%= text_field_tag :to_date, params[:to_date], placeholder: "e.g. 30/02/2013" %>
          </div>
        </div>
        <%= f.submit "Refresh results", class: "button" %>
      </fieldset>
    <%- end -%>
  </div>
</div>

<div class="filter-results-block">
  <div class="inner-block">
    <h2>This calendar of upcoming releases is maintained by the <a href="https://gss.civilservice.gov.uk/">Government Statistical Service</a> independently from government</h2>

    <div class="filter-results-summary">
      <div class="selections">
        <%= describe_filter @filter, date_prefix_text: "due" %>
      </div>
    </div>

    <div class="filter-results">
      <%- if @filter.results.any? -%>
        <ol class="document-list">
          <%= render @filter.results %>
        </ol>
      <%- else -%>
        <div class="no-results">
          <h2>There are no matching announcements.</h2>
          <p>Try making your search broader and try again.</p>
        </div>
      <%- end -%>
    </div>

    <% if @filter.results.number_of_pages > 1 %>
      <nav id="show-more-documents" role="navigation">
        <ul class="previous-next-navigation">
          <%= next_page_link(url:  statistics_announcements_path(@filter.next_page_params),
                             page: @filter.page + 1,
                             of:   @filter.results.number_of_pages) if @filter.results.next_page? %>

          <%= previous_page_link(url:  statistics_announcements_path(@filter.previous_page_params),
                                 page: @filter.page - 1,
                                 of:   @filter.results.number_of_pages) if @filter.results.previous_page? %>
        </ul>
      </nav>
    <% end %>
  </div>
</div>
